## topology-parkinglot ç½‘ç»œæ‹“æ‰‘ï¼ˆcppï¼‰
åœè½¦åœºæ‹“æ‰‘æ˜¯ä¸€ç§ç»“æ„åŒ–çš„ç½‘ç»œæ‹“æ‰‘
+ å•å±‚æ‹“æ‰‘+åŒå±‚æ‹“æ‰‘
+ pl_ppf_from_arrayï¼Œè¿­ä»£å¼æ‹¥å¡æ§åˆ¶ç®—æ³•
  + è®¡ç®—é“¾è·¯è´Ÿè½½
  + å¯»æ‰¾ç“¶é¢ˆé“¾è·¯
  + æ›´æ–°æ•°æ®æµçš„ä¼ è¾“é€Ÿç‡


## workloadåŸºæœ¬ç»“æ„ï¼ˆpythonï¼‰
+ workload æ•°æ®é€šå¸¸ç”±å¤šä¸ªæµç»„æˆï¼Œæ¯ä¸ªæµåŒ…å«ä»¥ä¸‹ä¿¡æ¯ï¼š
  + æºä¸»æœº (source host) å’Œ ç›®æ ‡ä¸»æœº (destination host)ï¼šæµçš„èµ·ç‚¹å’Œç»ˆç‚¹ã€‚
  + æµçš„å¤§å° (flow size)ï¼šå³æµä¼ è¾“çš„æ•°æ®é‡ï¼Œé€šå¸¸ä»¥å­—èŠ‚ä¸ºå•ä½ã€‚
  + æµçš„èµ·å§‹æ—¶é—´ (start time)ï¼šæµå¼€å§‹ä¼ è¾“çš„æ—¶é—´ï¼Œé€šå¸¸ä»¥ç§’ä¸ºå•ä½ã€‚
+ æä¾›äº†è‡ªè¡Œç”Ÿæˆæµçš„è„šæœ¬ï¼Œå¯ä»¥æ ¹æ®è¯»å–ç‰¹å®šæµé‡åˆ†å¸ƒçš„ CDF æ–‡ä»¶æ¥æ¨¡æ‹Ÿå…¶æµé‡åˆ†å¸ƒ
  + äº¤æ¢æœºåˆ°ä¸»æœºçš„é“¾è·¯æ¯”ä¾‹
  + æµçš„æ•°é‡
  + å¸¦å®½
  + å„æ¡é“¾è·¯çš„ç›¸å¯¹å¸¦å®½æ¯”ä¾‹s

## flowsim
ç®—æ³•æè¿°ï¼šæè¿°äº†åœ¨åœè½¦åœºæ‹“æ‰‘ä¸Šçš„è·¯å¾„çº§åˆ«ä»¿çœŸã€‚flowSim é€šè¿‡åˆå§‹åŒ–ä¸€ä¸ªä¼˜å…ˆé˜Ÿåˆ— ğ‘„ï¼Œå…¶ä¸­åŒ…å«æ‰€æœ‰æµ Fï¼ŒåŒ…æ‹¬å®ƒä»¬çš„å¤§å°å’Œåˆ°è¾¾æ—¶é—´ï¼ˆè§ç¬¬ 2 è¡Œï¼‰ã€‚æ¥ä¸‹æ¥ï¼ŒflowSim è°ƒåº¦æµçš„åˆ°è¾¾å’Œå®Œæˆäº‹ä»¶ï¼ˆè§ç¬¬ 4-10 è¡Œï¼‰ã€‚å¯¹äºæ¯ä¸ªäº‹ä»¶ï¼ŒflowSim è¿­ä»£åœ°è¯†åˆ«ç“¶é¢ˆé“¾è·¯åŠå…¶å…³è”çš„æµï¼ˆè§ç¬¬ 14 è¡Œï¼‰ï¼Œå¹¶é€šè¿‡è€ƒè™‘ç“¶é¢ˆé“¾è·¯çš„å®¹é‡ï¼Œä¸ºæ¯ä¸ªå…³è”æµåˆ†é… max-min é€Ÿç‡ï¼ˆè§ç¬¬ 11-17 è¡Œï¼‰ã€‚å½“æ‰€æœ‰æµéƒ½å®Œæˆæ—¶ï¼ŒflowSim ç»“æŸè¿è¡Œã€‚flowSim å³ä½¿åœ¨ä¸€ä¸ª 6 è·³çš„åœè½¦åœºæ‹“æ‰‘ä¸Šå¤„ç† 100 ä¸‡æ¡æµé‡ï¼Œä¹Ÿåªéœ€å‡ ç§’é’Ÿ 
![](pic/2.png)

ä¸ºäº†åœ¨æ•ˆç‡å’Œç²¾åº¦ä¹‹é—´å–å¾—å¹³è¡¡ï¼Œm3 å°† flowSim çš„ä¼°è®¡ç»“æœè½¬åŒ–ä¸ºç®€æ´çš„ç‰¹å¾å›¾ï¼Œå¦‚å›¾ 7(a) æ‰€ç¤ºã€‚ç»™å®šè·¯å¾„ \( P = (l_1, l_2, ..., l_n) \)ï¼Œå…¶ä¸­åŒ…å« \( n \) æ¡é“¾è·¯ï¼Œä»¥åŠä¸€ç»„å‰æ™¯æµ \( F \)ï¼ˆå›¾ä¸­çš„çº¢è‰²å®çº¿ï¼‰ï¼Œç‰¹å¾å›¾ \( M \) è¡¨ç¤ºä¸ºï¼š

\[
M_s^F, P_p = \{ Sldn(f) \mid f \in F, size(f) \in buckets_s, percentile(f) = p \}
\]
å…¶ä¸­ï¼Œm3 é¦–å…ˆæ ¹æ®æ¯ä¸ªæµçš„å¤§å°å°†å‰æ™¯æµåˆ†ç±»åˆ° s ä¸ªæ¡¶ä¸­ã€‚åœ¨æ¯ä¸ªæ¡¶ s ä¸­ï¼Œm3 è®°å½• flowSim é¢„æµ‹çš„æ—¶å»¶ (Sldn) ï¼Œå¹¶æŒ‰ p ä¸ªå›ºå®šç™¾åˆ†ä½æ•°è®¡ç®—ã€‚æœ€ç»ˆçš„ç‰¹å¾å›¾ç»´åº¦ä¸ºğ‘ Ã—ğ‘ï¼Œå¦‚æ©™è‰²çŸ©å½¢æ‰€ç¤ºã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œç‰¹å¾å›¾æœ‰ 10 ä¸ªæµå¤§å°æ¡¶ï¼ŒèŒƒå›´ä»å•ä¸ªåŒ…ä¸è¶³ 250B çš„æµåˆ°è¶…è¿‡ 50KB çš„æµï¼Œå¦‚å›¾ 3 æ‰€ç¤ºã€‚æ­¤å¤–ï¼Œå®ƒè¿˜åŒ…æ‹¬ 100 ä¸ªå›ºå®šç™¾åˆ†ä½æ•°ï¼ŒèŒƒå›´ä» 1% åˆ° 100%ï¼Œä»¥ 1% çš„å¢é‡é€’å¢

å‰æ™¯æµçš„æ€§èƒ½è¿˜å—åˆ°èƒŒæ™¯æµçš„æ•°é‡å’Œç‰¹æ€§ï¼ˆå¦‚å›¾ä¸­çš„è“è‰²è™šçº¿æ‰€ç¤ºï¼‰çš„å½±å“ã€‚æ²¿å‰æ™¯æµè·¯å¾„ä¸Šçš„æ¯æ¡é“¾è·¯ï¼Œm3 ä¸ºç»è¿‡è¯¥é“¾è·¯çš„èƒŒæ™¯æµç”Ÿæˆç±»ä¼¼çš„ç‰¹å¾å›¾ï¼ˆflowSim è®¡ç®—çš„èƒŒæ™¯æµ FCT æ—¶å»¶ç‰¹å¾å›¾ï¼Œç»´åº¦åŒä¸º ğ‘ Ã—ğ‘ï¼‰ã€‚
![](pic/1.png)



### flowsimæµç¨‹
**åœ¨æ¯ä¸€è½®ä¸­ï¼Œæ‰¾åˆ°å½“å‰æœ€ç´§ç¼ºçš„èµ„æºï¼ˆç“¶é¢ˆé“¾è·¯ï¼‰ï¼Œç„¶åä¸ºç“¶é¢ˆé“¾è·¯ä¸Šçš„æµåˆ†é…ä¸€ä¸ªå°½å¯èƒ½é«˜çš„é€Ÿç‡rï¼Œä½¿å¾—é“¾è·¯ä¸Šçš„æ‰€æœ‰æµéƒ½èƒ½å…¬å¹³åœ°ä½¿ç”¨å¸¦å®½**
1.	åˆå§‹åŒ–ä¼˜å…ˆé˜Ÿåˆ—ï¼š
	+ flowSim é¦–å…ˆé€šè¿‡å°†æ‰€æœ‰æµï¼ˆåŒ…æ‹¬å…¶å¤§å°å’Œåˆ°è¾¾æ—¶é—´ï¼‰æ·»åŠ åˆ°ä¼˜å…ˆé˜Ÿåˆ— Q ä¸­ï¼Œæ¥åˆå§‹åŒ–äº‹ä»¶é˜Ÿåˆ—ï¼ˆç®—æ³•ç¬¬ 2 è¡Œï¼‰ã€‚
2.	åŠ¨æ€æµäº‹ä»¶è°ƒåº¦ï¼š
	+ é€ä¸ªå¤„ç†äº‹ä»¶é˜Ÿåˆ—ä¸­çš„äº‹ä»¶ã€‚äº‹ä»¶åŒ…æ‹¬æµçš„åˆ°è¾¾äº‹ä»¶å’Œå®Œæˆäº‹ä»¶ã€‚åœ¨å¤„ç†æ¯ä¸ªäº‹ä»¶æ—¶ï¼ŒflowSim æ ¹æ®äº‹ä»¶ç±»å‹æ¥è¿›è¡Œç›¸åº”çš„æ“ä½œï¼ˆç®—æ³•ç¬¬ 4-10 è¡Œï¼‰ã€‚
	+ å¦‚æœæ˜¯åˆ°è¾¾äº‹ä»¶ï¼ŒflowSim å°†æ–°æµæ·»åŠ åˆ°æ´»åŠ¨æµé›†åˆ F* ä¸­ï¼›å¦‚æœæ˜¯å®Œæˆäº‹ä»¶ï¼Œåˆ™ä» F* ä¸­ç§»é™¤è¯¥æµï¼Œå¹¶è®°å½•å…¶å®Œæˆæ—¶é—´ã€‚
3.	æœ€å¤§-æœ€å°å…¬å¹³é€Ÿç‡åˆ†é…ï¼š
	+ å¯¹äºæ¯ä¸ªäº‹ä»¶ï¼ŒflowSim ä¼šé€šè¿‡ä»¥ä¸‹è¿‡ç¨‹æ¥åˆ†é…æœ€å¤§-æœ€å°å…¬å¹³é€Ÿç‡ï¼ˆç®—æ³•ç¬¬ 11-17 è¡Œï¼‰ï¼š
	+ åˆå§‹åŒ–æµé€Ÿç‡é›†åˆ R* å’Œé“¾è·¯å®¹é‡ C*ã€‚
	+	ä½¿ç”¨**è¿­ä»£ç®—æ³•æ‰¾åˆ°ç“¶é¢ˆé“¾è·¯**ï¼Œå¹¶ä¸ºç“¶é¢ˆé“¾è·¯ä¸Šçš„æ‰€æœ‰æµåˆ†é…æœ€å¤§-æœ€å°å…¬å¹³é€Ÿç‡
	+	é€šè¿‡è€ƒè™‘ç“¶é¢ˆé“¾è·¯çš„å®¹é‡æ¥**ä¸ºæ¯ä¸ªæµæ›´æ–°é€Ÿç‡**ï¼Œç¡®ä¿æ‰€æœ‰æµçš„é€Ÿç‡åˆ†é…æ˜¯å…¬å¹³çš„ã€‚
	+	æ›´æ–°é“¾è·¯å®¹é‡ï¼Œå¹¶æ ¹æ®æ–°çš„é€Ÿç‡åˆ†é…æ›´æ–°äº‹ä»¶é˜Ÿåˆ— Qï¼Œä»¥ä¾¿åœ¨ä¸‹ä¸€ä¸ªæ—¶é—´æ­¥ä½¿ç”¨ã€‚
4.	ç»ˆæ­¢æ¡ä»¶ï¼š
	+	å½“æ‰€æœ‰æµéƒ½å®Œæˆæ—¶ï¼Œä»¿çœŸç»“æŸã€‚

### ä¸»æœºå¯¹å¤šè·¯å¾„ç‰ˆflowsim
#### è·¯å¾„å‚¨å­˜
å¦‚ä½•å‚¨å­˜è·¯å¾„ï¼Ÿå½“å‰æ˜¯é€šè¿‡å¾ˆå¤šæ˜ å°„
+ sd_to_sdidè¡¨ç¤ºæº-ç›®æ ‡å¯¹çš„è·¯å¾„æ˜ å°„
+ sdid_to_linkid[][][up/down]è¡¨ç¤ºåœ¨sdidå¯¹åº”çš„è·¯å¾„ä¸­ï¼Œä»æºä¸»æœºå¯¹å…¶ç»è¿‡çš„ç¬¬iæ¡é“¾è·¯æ˜¯å¤šå°‘
+ linkid_to_sdid[][][up/down]è¡¨ç¤ºé“¾è·¯IDåˆ°æº-ç›®æ ‡å¯¹çš„æ˜ å°„ï¼Œè¡¨ç¤ºidä¸ºiçš„é“¾è·¯è¢«sd_idä¸ºjçš„æº-ç›®æ ‡ä¸»æœºå¯¹åœ¨up/downä¸­ä½¿ç”¨

è€ƒè™‘æ¯ä¸€å¯¹æº-ç›®æ ‡ä¸»æœºå¯¹çš„æ‰€æœ‰è·¯å¾„ï¼Œåœ¨å‚¨å­˜æ—¶sd_to_sdidè¦å¤š

**ä¿®æ”¹**
+ åœ¨sd_to_sdid,linkid_to_sdidä¸­æ·»åŠ ä¸€ä¸ªç»´åº¦ï¼Œå‚¨å­˜å¤šè·¯å¾„
+ ç»´æŠ¤ä¸€ä¸ªä»â€œæ¯ä¸ªæºï¼šç›®æ ‡ä¸»æœºå¯¹â€åˆ°è·¯å¾„æ•°ç›®çš„æ˜ å°„
#### æµçš„åˆ†é…ç­–ç•¥ï¼ˆæœ€å¤§æœ€å°å…¬å¹³é€Ÿç‡åˆ†é…ï¼‰
åœ¨æ¯æ¡è·¯å¾„ä¸Šéƒ½è¿›è¡Œé€Ÿç‡åˆ†é…ï¼Œè°ƒç”¨`pl_ppf_from_array`
ä¿®æ”¹
å¯¹äºæ¯ä¸€ä¸ªæ´»åŠ¨æµ fï¼š
    å¯¹äº f çš„æ¯ä¸€æ¡å¯ç”¨è·¯å¾„ pï¼š
        è®¡ç®—è·¯å¾„ p ä¸Šçš„è´Ÿè½½
        å¦‚æœè·¯å¾„ p çš„é™åˆ¶é€Ÿç‡æ›´å°ï¼Œåˆ™æ›´æ–° min_rate_limit

é—®é¢˜ï¼šæ‰¾ç“¶é¢ˆé“¾è·¯ï¼Œåˆ†é…é€Ÿç‡

+ æ•°æ®ç»“æ„
```cpp
struct {
    int path_count;
    int paths[MAX_PATHS][MAX_HOPS_PER_PATH]; //paths[i][j]è¡¨ç¤ºé“¾è·¯ä¸­ç¬¬i
} MultiPath;
```
+ é“¾è·¯è®¡ç®—ï¼šç”¨ç“¶é¢ˆå¸¦å®½æ¥è¡¨ç¤ºæŸæ¡é“¾è·¯çš„å¸¦å®½ï¼Ÿ
+ é“¾è·¯åˆ†é…ï¼šå¯¹äºæŸä¸€æ¡æµï¼ŒæŒ‰ç…§å…¶æ‰€æœ‰å¯ç”¨è·¯å¾„çš„å¸¦å®½æ¯”ä¾‹è¿›è¡Œåˆ†é…ï¼Ÿ/ç›´æ¥å¹³å‡åˆ†é…ï¼Ÿ





## æµç¨‹
1. è¾“å…¥ï¼šworkloadï¼ˆæ¯æ¡æµçš„id, source, destination, number of bytes, pathï¼‰å’Œtopology
ï¼ˆä¸m3åŸæœ¬çš„é€»è¾‘ä¸åŒï¼‰
2. æ ¹æ®æµæ•°é‡åŠ æƒé‡‡æ ·è‹¥å¹²æ¡è·¯å¾„ï¼Œå¹¶å»é‡ (parsimon-eval/expts/fig_8/src/experiment.rs line437-459)
3. å¯¹äºæ¯æ¡è·¯å¾„è¿›è¡Œæšä¸¾ (parsimon-eval/expts/fig_8/src/experiment.rs line461)
	+ ç»Ÿè®¡è·¯å¾„ä¸Šçš„æ‰€æœ‰æµ (parsimon-eval/expts/fig_8/src/experiment.rs line465-517)
	+ è°ƒç”¨mlsysæ¨¡å‹ (parsimon-eval/expts/fig_8/src/experiment.rs line518-563, parsimon-eval/expts/fig_8/src/mlsys.rs line62-118)ï¼ˆ**ç›´æ¥ç”¨run.cé‡Œçš„cä»£ç **ï¼‰
		+ å°†æµæ”¾å…¥flowsimè¿›è¡Œæ¨¡æ‹Ÿè®¡ç®— (clibs/run.c line1161-1172)
		+ æ ¹æ®FCTå’Œidea FCTè®¡ç®—slowdown(sldn) (clibs/run.c line1176-1211)
		+ åŒºåˆ†å‰æ™¯æµå’ŒèƒŒæ™¯æµï¼Œåˆ†åˆ«å¾—åˆ°feature map (clibs/run.c line1231-1328)
		+ è°ƒç”¨transformerå’Œmlp (clibs/run.c line1330-1363)





### å‘½ä»¤
cd parsimon/backends/High-Precision-Congestion-Control/simulation
CC='gcc-5' CXX='g++-5' CXXFLAGS='-std=c++11' ./waf configure --build-profile=optimized

cd parsimon/backends/High-Precision-Congestion-Control/gen_path
cargo run --release -- --python-path /users/ymy_yuan/anaconda3/envs/m3/bin/python --output-dir /users/ymy_yuan/m3/data


```cpp
./run ../ckpts/model_llama{model_suffix}.bin ../ckpts/model_mlp{model_suffix}.bin {data_dir} -b 10 -e 576 -n {n_hosts} -t 1 -f {bfsz} -k {window} -p {enable_pfc} -c {cc} -x {param_1} -y {param_2} > {data_dir}/output.txt 2>&1
```
+ n_hosts:path_length
+ bfsz:mix.bfsz
+ window:mix.window
+ enable_pfc:mix.enable_pfc
+ cc:mix.cc
+ param_1:mix.param_1
+ param_2:mix.param_2



```cpp
cd /users/ymy_yuan/m3/parsimon-eval/expts/fig_8/src

./run /users/ymy_yuan/m3/ckpts/model_llama.bin /users/ymy_yuan/m3/ckpts/model_mlp.bin /users/ymy_yuan/m3/parsimon-eval/expts/fig_8/data -b 10 -e 576 -t 1 -f 40.0 -k 16515 -p 1.0 -c dctcp -x 10.842025307341636 -y 0.0


g++ -fsanitize=address -g my_build.cpp my_lib.cpp topo.c -o run
gdb ./run
set args /users/ymy_yuan/m3/ckpts/model_llama.bin /users/ymy_yuan/m3/ckpts/model_mlp.bin /users/ymy_yuan/m3/parsimon-eval/expts/fig_8/data -b 10 -e 576 -t 1 -f 40.0 -k 16515 -p 1.0 -c dctcp -x 10.842025307341636 -y 0.0
run
```



python main_train.py --train_config=/users/ymy_yuan/m3/config/train_config_path.yaml --mode=train --dir_input=/users/ymy_yuan/m3/data --dir_output=/users/ymy_yuan/m3/ckpts


python main_train.py --train_config=/users/ymy_yuan/m3/config/train_config_path_demo.yaml --mode=train --dir_input=/users/ymy_yuan/m3/data --dir_output=/users/ymy_yuan/true_m3/ckpts


print(sizebucket_to_sldn_est.add_(-1.0))
print(sizebucket_to_sldn_est)
print(sizebucket_to_sldn)

 
## é¡¹ç›®ç›®å½•ç»“æ„

- **ckpts**  
  ç”¨äºå­˜æ”¾Llama-2å’Œ2å±‚MLPçš„æ£€æŸ¥ç‚¹æ–‡ä»¶ï¼Œè¿™äº›æ–‡ä»¶åœ¨m3ä¸­ä½¿ç”¨ã€‚

- **clibs**  
  ç”¨äºè¿è¡Œm3ä¸­çš„è·¯å¾„çº§æ¨¡æ‹Ÿçš„Cè¯­è¨€åº“ã€‚

- **config**  
  åŒ…å«ç”¨äºè®­ç»ƒå’Œæµ‹è¯•m3çš„é…ç½®æ–‡ä»¶ã€‚

- **parsimon**  
  åŒ…å«Parsimonå’Œm3çš„æ ¸å¿ƒåŠŸèƒ½ã€‚
  - **backends**
    - **High-Precision-Congestion-Control**  
      HPCCï¼ˆé«˜ç²¾åº¦æ‹¥å¡æ§åˆ¶ï¼‰åº“ï¼Œç”¨äºæ•°æ®ç”Ÿæˆã€‚
****
- **parsimon-eval**  
  åŒ…å«é‡ç°m3å®éªŒåŠå…¶å¯¹æ¯”å®éªŒçš„è„šæœ¬ã€‚

- **util**  
  åŒ…å«m3çš„å®ç”¨å‡½æ•°ï¼ŒåŒ…æ‹¬æ•°æ®åŠ è½½å™¨å’Œæœºå™¨å­¦ä¹ æ¨¡å‹çš„å®ç°ã€‚

- **gen_ckpts.py**  
  ç”¨äºç”Ÿæˆm3æ£€æŸ¥ç‚¹çš„è„šæœ¬ã€‚

- **main_train.py**  
  ç”¨äºè®­ç»ƒå’Œæµ‹è¯•m3çš„ä¸»è„šæœ¬ã€‚


### æ¨¡å‹è¿‡ç¨‹
#### æ„å»ºdatamodule
1. åœ¨è®­ç»ƒæ¨¡å¼ä¸‹ï¼Œå¾ªç¯éå† shardã€æµé‡æ•°é‡ã€ä¸»æœºæ•°é‡ï¼Œå¹¶ç”Ÿæˆä»¿çœŸå·¥ä½œè´Ÿè½½çš„ä¸åŒç»„åˆã€‚æœ€å**æ‰“ä¹±**ï¼Œä½œä¸º**data_list**
2. setup,è®¾ç½®è®­ç»ƒ/æµ‹è¯•çš„æ•°æ®é›†
   + å¦‚æœæ˜¯è®­ç»ƒæ¨¡å¼ï¼Œåˆ™å°†data_liståˆ†ä¸ºè®­ç»ƒé›†å’ŒéªŒè¯é›†
   + å¦‚æœæ˜¯æµ‹è¯•æ¨¡å¼ï¼Œåˆ™æ ¹æ®ç»éªŒæ•°æ®ç”Ÿæˆæµ‹è¯•é›†
3. get_item,è·å–æ•°æ®é›†ä¸­çš„ä¸€ä¸ªæ ·æœ¬


#### è®­ç»ƒæ¨¡å‹FlowSimTransformer_Path
trainer.fit(model, datamodule)
1. å‡†å¤‡æ•°æ®
  + setup(stage="fit")
  + train_dataloader()
2. åˆå§‹åŒ–æ¨¡å‹
3. è®­ç»ƒå¾ªç¯
  + æ¯ä¸ªepochéƒ½ä¼šè°ƒç”¨training_step
  + æ¯ä¸ªepochç»“æŸæ—¶ï¼Œä¼šè°ƒç”¨validation_step
4. å›è°ƒ










#### å‚æ•°


base-line:
Epoch 499: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 22/22 [00:07<00:00,  3.10it/s, v_num=3, train_loss_sync_step=0.0316, val_loss_sync_step=0.227, val_loss_sync_epoch=0.400, train_loss_sync_epoch=0.0288]


train_frac: 0.9
Epoch 499: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 22/22 [00:07<00:00,  2.99it/s, v_num=6, train_loss_sync_step=0.0538, val_loss_sync_step=0.516, val_loss_sync_epoch=1.040, train_loss_sync_epoch=0.0769]


train_frac: 0.95(comment out the in-place add operation)
Epoch 499: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 23/23 [00:07<00:00,  3.10it/s, v_num=1, train_loss_sync_step=0.0536, val_loss_sync_step=0.584, val_loss_sync_epoch=0.545, train_loss_sync_epoch=0.0832]